<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta property="og:title" content="simple-reload"/>
<meta property="og:site_name" content="Muxup">
<meta property="og:description" content="A simple approach to reloading pages in the browser during iterative development"/>
<meta property="og:type" content="article"/>
<meta property="og:url" content="https://muxup.com/simple-reload"/>
<meta property="og:image" content="https://v1.screenshot.11ty.dev/https%3A%2F%2Fmuxup.com%2Fsimple-reload/opengraph/ar/bigger"/>
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:site" content="@muxup">
<meta property="twitter:creator" content="@asbradbury">
<title>simple-reload - Muxup</title>
<link rel="icon" sizes="any" href="data:image/svg+xml,%3Csvg xmlns='http:%2F%2Fwww.w3.org%2F2000%2Fsvg' viewBox='0 0 100 100'%3E%3Ctext y='80' font-size='110'%3E▨%3C%2Ftext%3E%3C%2Fsvg%3E">
<meta name="description" content="A simple approach to reloading pages in the browser during iterative development">
<style>
@font-face {
font-family:'Nunito Var';
src:url('/static/Nunito.var.woff2') format('woff2-variations');
font-display:swap;
font-weight: 200 1000;
}
*, *::before, *::after {
box-sizing:border-box;
}
* {
margin:0;
}
input, button, textarea, select {
font:inherit;
}
img, picture, video, canvas, svg {
display:block;
max-width:100%;
}
html {
font-family:'Nunito Var', sans-serif;
height:100%;
font-size:16px;
-webkit-tap-highlight-color:transparent;
}
@media screen and (min-width:640px) {
html {
font-size:18px;
}
}
body {
line-height:1.5;
color:#222;
display:grid;
height:100%;
grid-template-rows:1fr auto;
background:#fff no-repeat 0% 0% / 100% .7rem linear-gradient(120deg, #ffffe3 20%, #ddfffc 20%, #ddfffc 40%, #e2eeff 40%, #e2eeff 60%, #f2e2ff 60%, #f2e2ff 80%, #ffdef2 80%, #ffdef2 100%);
tab-size:4;
}
h1, h2, h3, h4, h5, h6 {
line-height:1.25;
font-weight:600;
overflow-wrap:break-word;
letter-spacing:-.025em;
margin:1.75rem 0 .75rem;
}
h1 {
font-size:2.986rem
}
h2 {
font-size:2.488rem
}
p {
margin:.75rem 0;
font-weight:400;
overflow-wrap:break-word;
}
a {
color:inherit;
text-decoration:underline;
text-decoration-color:#aaa;
text-underline-offset:.15em;
}
a:hover {
text-decoration-thickness:2px;
}
ol, ul {
margin:0 0 0 1.5rem;
padding-left:0;
}
li {
margin:0 0 .25rem
}
::selection {
background:#ffdac0;
}
footer {
display:grid;
grid-auto-flow:column;
align-items:center;
justify-content:center;
white-space:pre-wrap;
padding:.5rem 0;
font-size:.833rem;
color:#777;
min-height:75px;
}
@keyframes rotation {
from {
transform:rotate(0deg);
}
to {
transform:rotate(359deg);
}
}
#footer-image:hover {
animation:rotation .6s 1 linear;
cursor:pointer;
}
#article-logo {
line-height:1.25;
margin:.5rem 0 0;
font-size:1.44rem;
font-weight:700;
position:relative;
}
#article-logo a {
text-decoration:none;
}
#article-title {
margin:1.5rem 0 0;
position:relative;
}
#article-meta {
font-size:.833rem;
color:#777;
}
#article-container {
margin:0 auto;
padding:1rem;
max-width:min(calc(750px + 2rem), calc(100vw - 1rem));
width:100%;
}
.anchor {
position: absolute;
text-decoration: none;
width:1.75ex;
margin-left:-1.4ex;
visibility:hidden;
font-size:.8em;
padding-top:.2em;
color:#aaa;
}
h2:hover .anchor,
h3:hover .anchor,
h4:hover .anchor,
h5:hover .anchor,
h6:hover .anchor,
summary:hover .anchor {
visibility:visible;
}
.anchor::before {
content:"#";
}
hr {
border:none;
border-top:2px solid #dadee4;
}
code {
background:#f5f5f5;
padding:.125rem .25rem;
font-size:.833rem
}
pre > code {
padding:0;
background:#fff;
}
pre {
word-wrap:break-word;
overflow-x:auto;
padding:.5rem 1rem;
margin:1rem -1rem;
border-radius:.4rem;
border:1px solid #d2d2d2;
}
details {
font-size:.833rem;
}
details summary {
margin:.75rem 0 .5rem 0;
font-weight:600;
cursor:pointer;
font-size:1.2rem;
line-height:1.25;
letter-spacing:-.025em;
list-style:none;
}
details summary > * {
display:inline;
}
summary::-webkit-details-marker {
display:none;
}
summary::after {
font-size:1rem;
content: " ≫";
}
details[open] summary::after {
content: " ≪";
}

</style>
<link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml"/>
<link rel="canonical" href="https://muxup.com/simple-reload"/>
</head>
<body>
<div id="article-container">
<div>
<div id="article-logo"><span id="logo-highlight"><a href="/">Muxup</a></a></div>
</div>
<h1 id="article-title"><span id="title-highlight">simple-reload</span></h1>
<div id="article-meta">Last update <span title="2022-09-11">11 Sep 2022</span>. <a href="#article-changelog" onclick="document.querySelector('#article-changelog').setAttribute('open', true)">History↓</a></div>
<h2 id="summary"><a href="#summary" class="anchor" aria-hidden="true" tabindex="-1"></a>Summary</h2>
<p>simple-reload provides a straight-forward (~30 lines of JS and zero
server-side requirements) way of reloading a web page as it is iteratively
developed or modified. Once activated, a page will be reloaded
whenever it regains focus.</p>
<h2 id="trade-offs"><a href="#trade-offs" class="anchor" aria-hidden="true" tabindex="-1"></a>Trade-offs</h2>
<p>Mature solutions like
<a href="https://github.com/livereload/livereload-js">LiveReload</a> are available, which
makes a different set of trade-offs. Please read this section carefully to
determine if simple-reload makes sense for you:</p>
<p><strong>Cons</strong>:</p>
<ul>
<li>Reload won&#x27;t take place until the page is focused by the user, which
requires manual interaction.
<ul>
<li>This is significantly less burdensome if using focus follows pointer in
your window manager.</li>
</ul>
</li>
<li>Reloads will occur even if there were no changes.
<ul>
<li>With e.g. LiveReload, a reload only happens when the server indicates
there has been a change. This may be a big advantage for stateful pages or
pages with lots of forms.</li>
</ul>
</li>
</ul>
<p><strong>Pros</strong>:</p>
<ul>
<li>Tiny, easy to modify implementation.</li>
<li>Can dynamically enable/disable reloading on a per-tab basis.
<ul>
<li>This can be helpful to keep a fixed revision of a page in one tab to
compare against.</li>
</ul>
</li>
<li>No server-side requirements.
<ul>
<li>So works even from <code>file://</code>.</li>
<li>Makes it easier if using with a remote server (e.g. no need to worry about
exposing a port as for LiveReload).</li>
</ul>
</li>
</ul>
<h2 id="code"><a href="#code" class="anchor" aria-hidden="true" tabindex="-1"></a>Code</h2>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #000000">&lt;script</span> <span style="color: #000000">type=</span><span style="color: #C41A16">&quot;module&quot;</span><span style="color: #000000">&gt;</span>
<span style="color: #177500">// Set to true to enable reloading from first load.</span>
<span style="color: #A90D91">const</span> <span style="color: #000000">enableByDefault</span> <span style="color: #000000">=</span> <span style="color: #A90D91">false</span>;
<span style="color: #177500">// Firefox triggers blur/focus events when resizing, so we ignore a focus</span>
<span style="color: #177500">// following a blur within 200ms (assumed to be generated by resizing rather</span>
<span style="color: #177500">// than human interaction).</span>
<span style="color: #A90D91">let</span> <span style="color: #000000">blurTimeStamp</span> <span style="color: #000000">=</span> <span style="color: #A90D91">null</span>;
<span style="color: #A90D91">function</span> <span style="color: #000000">focusListener</span>(<span style="color: #000000">ev</span>) {
  <span style="color: #A90D91">if</span> (<span style="color: #000000">ev</span>.<span style="color: #000000">timeStamp</span> <span style="color: #000000">-</span> <span style="color: #000000">blurTimeStamp</span> <span style="color: #000000">&gt;=</span> <span style="color: #1C01CE">200</span>) {
    <span style="color: #000000">location</span>.<span style="color: #000000">reload</span>();
  }
}
<span style="color: #A90D91">function</span> <span style="color: #000000">blurListener</span>(<span style="color: #000000">ev</span>) {
  <span style="color: #A90D91">if</span> (<span style="color: #000000">blurTimeStamp</span> <span style="color: #000000">===</span> <span style="color: #A90D91">null</span>) {
    <span style="color: #A90D91">window</span>.<span style="color: #000000">addEventListener</span>(<span style="color: #C41A16">&quot;focus&quot;</span>, <span style="color: #000000">focusListener</span>);
  }
  <span style="color: #000000">blurTimeStamp</span> <span style="color: #000000">=</span> <span style="color: #000000">ev</span>.<span style="color: #000000">timeStamp</span>;
}
<span style="color: #A90D91">function</span> <span style="color: #000000">deactivate</span>() {
  <span style="color: #000000">sessionStorage</span>.<span style="color: #000000">removeItem</span>(<span style="color: #C41A16">&quot;simple-reload&quot;</span>);
  <span style="color: #A90D91">window</span>.<span style="color: #000000">removeEventListener</span>(<span style="color: #C41A16">&quot;focus&quot;</span>, <span style="color: #000000">focusListener</span>);
  <span style="color: #A90D91">window</span>.<span style="color: #000000">removeEventListener</span>(<span style="color: #C41A16">&quot;blur&quot;</span>, <span style="color: #000000">blurListener</span>);
  <span style="color: #A90D91">document</span>.<span style="color: #000000">title</span> <span style="color: #000000">=</span> <span style="color: #A90D91">document</span>.<span style="color: #000000">title</span>.<span style="color: #000000">replace</span>(<span style="color: #C41A16">/^\u27F3 /</span>, <span style="color: #C41A16">&quot;&quot;</span>);
  <span style="color: #A90D91">window</span>.<span style="color: #000000">addEventListener</span>(<span style="color: #C41A16">&quot;dblclick&quot;</span>, <span style="color: #000000">activate</span>, { <span style="color: #000000">once:</span> <span style="color: #A90D91">true</span> });
}
<span style="color: #A90D91">function</span> <span style="color: #000000">activate</span>() {
  <span style="color: #000000">sessionStorage</span>.<span style="color: #000000">setItem</span>(<span style="color: #C41A16">&quot;simple-reload&quot;</span>, <span style="color: #C41A16">&quot;activated&quot;</span>);
  <span style="color: #000000">location</span>.<span style="color: #000000">reload</span>();
}
<span style="color: #A90D91">if</span> (<span style="color: #000000">enableByDefault</span> <span style="color: #000000">||</span> <span style="color: #000000">sessionStorage</span>.<span style="color: #000000">getItem</span>(<span style="color: #C41A16">&quot;simple-reload&quot;</span>) <span style="color: #000000">==</span> <span style="color: #C41A16">&quot;activated&quot;</span>) {
  <span style="color: #A90D91">document</span>.<span style="color: #000000">title</span> <span style="color: #000000">=</span> <span style="color: #C41A16">&quot;\u27F3 &quot;</span> <span style="color: #000000">+</span> <span style="color: #A90D91">document</span>.<span style="color: #000000">title</span>;
  <span style="color: #000000">sessionStorage</span>.<span style="color: #000000">setItem</span>(<span style="color: #C41A16">&quot;simple-reload&quot;</span>, <span style="color: #C41A16">&quot;activated&quot;</span>);
  <span style="color: #A90D91">window</span>.<span style="color: #000000">addEventListener</span>(<span style="color: #C41A16">&quot;blur&quot;</span>, <span style="color: #000000">blurListener</span>);
  <span style="color: #A90D91">window</span>.<span style="color: #000000">addEventListener</span>(<span style="color: #C41A16">&quot;dblclick&quot;</span>, <span style="color: #000000">deactivate</span>, { <span style="color: #000000">once:</span> <span style="color: #A90D91">true</span> });
} <span style="color: #A90D91">else</span> {
  <span style="color: #A90D91">window</span>.<span style="color: #000000">addEventListener</span>(<span style="color: #C41A16">&quot;dblclick&quot;</span>, <span style="color: #000000">activate</span>);
}
<span style="color: #000000">&lt;/script&gt;</span>
</code></pre></div>

<h2 id="usage"><a href="#usage" class="anchor" aria-hidden="true" tabindex="-1"></a>Usage</h2>
<p>Paste the above code into the <code>&lt;head&gt;</code> or <code>&lt;body&gt;</code> of a HTML file. You can
then enable the reload behaviour by double-clicking on a page (double-click
again to disable again). The title is prefixed with ⟳ while reload-on-focus is
enabled. If you&#x27;d like reload-on-focus enabled by default, just flip the
<code>enableByDefault</code> variable to <code>true</code>. You could either modify
whatever you&#x27;re using to emit HTML to include this code when in development
mode, or configure your web server of choice to inject it for you.</p>
<p>The enabled/disabled state of the reload logic is scoped to the current tab,
so will be maintained if navigating to different pages within the same domain
in that tab.</p>
<p>In terms of licensing, the implementation is so straight-forward it hardly
feels copyrightable. Please consider it public domain, or MIT if you&#x27;re more
comfortable with an explicit license.</p>
<h2 id="implementation-notes"><a href="#implementation-notes" class="anchor" aria-hidden="true" tabindex="-1"></a>Implementation notes</h2>
<ul>
<li>In case it&#x27;s not clear, &quot;blur&quot; events mentioned above are events fired when
an element is no longer in focus.</li>
<li>As noted in the code comment, Firefox (under dwm in Linux at least) seems to
trigger blur+focus events when resizing the window using a keybinding while
Chrome doesn&#x27;t. Being able to remove the logic to deal with this issue would
be a good additional simplification.</li>
</ul>
<hr/><details id="article-changelog"><summary><a href="#article-changelog" class="anchor "aria-hidden="true" tabindex="-1"></a>Article changelog</summary>
<ul>
<li>2022-09-11: Removed incorrect statement about <code>sessionStorage</code> usage being
redundant if <code>enableByDefault = true</code> (it does mean disabling reloading will
persist).</li>
<li>2022-09-10: Initial publication date.</li>
</ul>
</details>

</div>
<footer class="footer">Curated by Alex Bradbury, &copy; <a href="/">Muxup</a> contributors. <a href="/about">About</a>. 
<img id="footer-image" src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%3E%3C/svg%3E" width="50" height="50"/>
</footer>
<script>
const t="http://www.w3.org/2000/svg";function o(t){return Math.random()*(2*t)-t}function n(t){const n=t.t.getBoundingClientRect();const e=t.o.getClientRects();let f="";for(const t of e){const e=t.x-n.x,c=t.y-n.y,s=t.width,r=t.height;const i=c+r/2;let l=s<75?3:s<300?6:8;const u=.2+.2*Math.random();f=`${f}\n      M${e+o(l)} ${i+o(l)}\n      C${e+s*u+o(l)} ${i+o(l)},\n       ${e+2*s*u+o(l)} ${i+o(l)}\n       ${e+s+o(l)} ${i+o(l)}`}t.i=f;t.strokeWidth=.85*e[0].height}const e=new Map;let f=new ResizeObserver((t=>{for(const o of t){const t=e.get(o.target);if(!t.i)n(t)}for(const o of t){s(e.get(o.target))}}));function c(o){const n=document.createElementNS(t,"svg");n.style.position="absolute";n.style.zIndex=-1;n.style.top="0";n.style.left="0";n.style.overflow="visible";const e=document.createElementNS(t,"path");e.setAttribute("fill","none");e.setAttribute("stroke",o.l);n.appendChild(e);o.o.insertAdjacentElement("beforebegin",n);o.t=n}function s(t){if(!t.i){n(t)}const o=t.t.children[0];o.setAttribute("stroke-width",t.strokeWidth);o.setAttribute("d",t.i);t.i=null}function r(){for(const t of e.values()){c(t)}for(const t of e.values()){n(t)}for(const t of e.keys()){f.observe(t)}document.fonts.ready.then((()=>i()))}function i(){for(const t of e.values()){n(t)}for(const t of e.values()){s(t)}}function l(t,o){let n;t.addEventListener("mouseover",(()=>{s(o);n=setInterval((()=>s(o)),240)}),false);t.addEventListener("mouseout",(()=>{clearInterval(n)}));t.addEventListener("click",(()=>{clearInterval(n)}))}function u(t,o,n){let f={o:t,u:o,l:n};e.set(o,f);return f}let a=new Set([window.location.pathname]);const h=document.querySelector("#footer-image");let d=null;function g(){let t=Math.floor(Math.random()*94);d="/static/footer/"+String(t).padStart(4,"0")+".svg"}function m(t){h.src=d;g();if(!t)v()}function v(){if(a.has(d))return;a.add(d);fetch(d)}g();m(true);let w=null;h.addEventListener("click",(()=>{if(w){w.pause();w.play()}m()}));h.addEventListener("mouseover",(()=>{const t=h.getAnimations();if(t.length!=0)w=t[0];v()}));function $(t){const o=t.currentTarget.getAttribute("href").split("#")[0];if(a.has(o))return;a.add(o);fetch(o)}const M=document.getElementsByTagName("a");for(const t of M){const o=(t.getAttribute("href")??"").split("#")[0];if(o.includes("?")||!o.startsWith("/")||o.slice(o.lastIndexOf("/")+1).includes(".")){continue}t.addEventListener("mouseover",$)}const k=["#ffdef2","#f2e2ff","#e2eeff","#ddfffc","#ffffe3"];const b=document.querySelector("#title-highlight");u(b,b.parentNode,k[Math.floor(Math.random()*k.length)]);const p=document.querySelector("#logo-highlight");const I=u(p,p.parentNode,"#ffdac0");r();l(p,I);

</script>
</body>
</html>
